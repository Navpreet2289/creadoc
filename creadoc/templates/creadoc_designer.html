<!DOCTYPE html>
<html>
<head>
    <title>Дизайнер отчетов</title>
    <meta charset="utf-8" />
    <link href="/static/css/demo.css" rel="stylesheet">
    <link href="/static/css/stimulsoft.viewer.office2013.css" rel="stylesheet">
    <link href="/static/css/stimulsoft.designer.office2013.white.blue.css" rel="stylesheet">
    <script src="/static/scripts/stimulsoft.reports.js" type="text/javascript"></script>
    <script src="/static/scripts/stimulsoft.viewer.js" type="text/javascript"></script>
    <script src="/static/scripts/stimulsoft.designer.js" type="text/javascript"></script>
    <script src="/static/reports/EmptyReport.js?1" type="text/javascript"></script>
    <script src="/static/reports/Demo.js" type="text/javascript"></script>
    <script>
        /**
         * Формирование дизайнера отчета
         */
        function createDesigner() {
            // Параметры дизайнера отчетов
            var options = new Stimulsoft.Designer.StiDesignerOptions();
            options.appearance.fullScreenMode = true;

            // Формирование экземпляра дизайнера
            var designer = new Stimulsoft.Designer.StiDesigner(options, "StiDesigner", false);

            // Логика, выполняемая при выходе из дизайнера
            designer.onExit = function(e) {
                this.visible = false;
            };

            // Формируем экземпляр отчета
            var report = new Stimulsoft.Report.StiReport();
            // Загружаем шаблон отчета
            // Можно использовать шаблоны *.mrt в json
            report.load(EmptyReport);

            // Привязка переменных к шаблону
            {% for source in element_data_sources %}
            report.dictionary.variables.add(
                new Stimulsoft.Report.Dictionary.StiVariable(
                    // Категория
                    '{{ source.category }}',
                    // Наименование
                    '{{ source.name }}',
                    // Псевдоним
                    '{{ source.name }}',
                    // Описание
                    '{{ source.description }}',
                    // Тип
                    String,
                    // Значение
                    '{{ source.data }}'
                )
            );
            {% endfor %}

            // Привязка источников данных к шаблону
            // TODO: Привязка тестового источника
            report.regData("Demo", "Demo", Demo);
            // Связывание шаблона и дизайнера
            designer.report = report;
            // Рендерим дизайнер в элемент с указанным идентификатором
            designer.renderHtml("designerContent");
        }

        window.onload = function() {
            // Загружаем файл локализации и устанавливаем его по умолчанию
            Stimulsoft.Base.Localization.StiLocalization.setLocalizationFile("/static/local/ru.xml", true);
            createDesigner();
        };
    </script>
</head>
<body>
    <div id="designerContent"></div>
</body>
</html>